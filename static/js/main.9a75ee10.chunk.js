(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{39:function(e,t,r){e.exports=r(55)},44:function(e,t,r){},45:function(e,t,r){},55:function(e,t,r){"use strict";r.r(t);var n=r(0),a=r.n(n),c=r(21),o=r.n(c),i=(r(44),r(22)),u=r(16),l=(r(45),r(5)),s=r(6),d=r(8),b=r(7),m=r(9),f=r(13),p=r(14),h=r(12);function v(){var e=Object(f.a)(["\n  display: table-row;\n"]);return v=function(){return e},e}var E=p.a.div(v());function O(){var e=Object(f.a)(["\n  display: inline-block;\n  padding: 8px;\n  display: table-cell;\n  border: 1px solid #d2d2d2;\n  border-top-width: 0px;\n\n  &:not(:first-of-type) {\n    border-left-width: 0px;\n  }\n"]);return O=function(){return e},e}var y=p.a.div(O());function g(){var e=Object(f.a)(["\n  border: none;\n"]);return g=function(){return e},e}var j=Object(p.a)(y)(g()),R=function(e){var t=e.onClick;return a.a.createElement(j,null,a.a.createElement("button",{onClick:t},"Cancel"))},w=Object(h.a)(function(e){function t(){var e,r;Object(l.a)(this,t);for(var n=arguments.length,a=new Array(n),c=0;c<n;c++)a[c]=arguments[c];return(r=Object(d.a)(this,(e=Object(b.a)(t)).call.apply(e,[this].concat(a)))).setRecordID=function(e){var t=e.target;r.props.recordDraft.setID(t.value)},r.setRecordAttribute=function(e){var t=e.target,n=t.name,a=t.value,c=r.props.recordDraft;c.setAttribute(n,a),console.log(c.attributes)},r}return Object(m.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){var e=this,t=this.props,r=t.recordDraft,n=t.columns,c=t.submitLabel,o=t.onSubmit,i=t.onCancel,u=r.id,l=r.attributes;return a.a.createElement(E,{as:"form",onSubmit:o},a.a.createElement(y,null,a.a.createElement("input",{name:"id",value:u,onChange:this.setRecordID,disabled:!0})),n.map(function(t){return a.a.createElement(y,{key:t},a.a.createElement("input",{name:t,value:l[t],onChange:e.setRecordAttribute}))}),a.a.createElement(y,null,"\u2014"),a.a.createElement(j,null,a.a.createElement("button",{type:"submit"},c)),i?a.a.createElement(R,{onClick:i}):null)}}]),t}(n.Component)),k=Object(h.a)(function(e){function t(e){var r;return Object(l.a)(this,t),(r=Object(d.a)(this,Object(b.a)(t).call(this,e))).saveRecord=function(e){e.preventDefault();var t=r.props.table,n=r.state.recordDraft;n.id&&(t.addRecord(n),n.persist(),r.clearForm())},r.state={recordDraft:e.table.newRecord()},r}return Object(m.a)(t,e),Object(s.a)(t,[{key:"clearForm",value:function(){var e=this.props.table;this.setState({recordDraft:e.newRecord()})}},{key:"render",value:function(){var e=this.props.columns,t=this.state.recordDraft;return a.a.createElement(w,{recordDraft:t,columns:e,submitLabel:"Create",onSubmit:this.saveRecord})}}]),t}(n.Component)),D=function(e){function t(e){var r;return Object(l.a)(this,t),(r=Object(d.a)(this,Object(b.a)(t).call(this,e))).resetRecord=function(e){e.preventDefault(),r.props.afterEditRecord()},r.updateRecord=function(e){e.preventDefault();var t=r.state.recordDraft,n=r.props,a=n.record,c=n.afterEditRecord;a.update(t.attributes),c()},r.state={recordDraft:e.record.copy()},r}return Object(m.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){var e=this.props.columns,t=this.state.recordDraft;return a.a.createElement(w,{recordDraft:t,columns:e,submitLabel:"Update",onSubmit:this.updateRecord,onCancel:this.resetRecord})}}]),t}(n.Component),L=Object(h.a)(function(e){function t(e){var r;return Object(l.a)(this,t),(r=Object(d.a)(this,Object(b.a)(t).call(this,e))).enterEditMode=function(){r.setState({editMode:!0})},r.exitEditMode=function(){r.setState({editMode:!1})},r.state={editMode:!1},r}return Object(m.a)(t,e),Object(s.a)(t,[{key:"editMode",value:function(){return this.state.editMode}},{key:"render",value:function(){var e=this.props,t=e.record,r=e.columns,n=t.id,c=t.attributes,o=t.timestamp;return this.editMode()?a.a.createElement(D,{record:t,columns:r,afterEditRecord:this.exitEditMode}):a.a.createElement(E,null,a.a.createElement(y,null,n),r.map(function(e){return a.a.createElement(y,{key:e},c[e])}),a.a.createElement(y,null,o),a.a.createElement(j,null,a.a.createElement("button",{onClick:this.enterEditMode},"Edit")),a.a.createElement(j,null,a.a.createElement("button",{onClick:t.destroy},"Delete")))}}]),t}(n.Component)),C=Object(h.a)(function(e){var t=e.records,r=e.columns;return t.map(function(e){return a.a.createElement(L,{key:e.id,record:e,columns:r})})});function I(){var e=Object(f.a)(["\n  background: black;\n  color: white;\n\n  div {\n    font-weight: bold;\n    border-color: black;\n    border-top-width: 1px;\n\n    &:not(:last-of-type) {\n      border-right-color: white;\n    }\n  }\n"]);return I=function(){return e},e}function S(){var e=Object(f.a)(["\n  display: table;\n"]);return S=function(){return e},e}var U=p.a.div(S()),A=Object(p.a)(E)(I()),M=Object(h.a)(function(e){function t(){return Object(l.a)(this,t),Object(d.a)(this,Object(b.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(s.a)(t,[{key:"componentDidMount",value:function(){this.props.table.fetchRecords()}},{key:"render",value:function(){var e=this.props.table,t=e.records,r=e.columns;return a.a.createElement(U,null,a.a.createElement(A,null,a.a.createElement(y,null,"ID"),r.map(function(e){return a.a.createElement(y,{key:e},e)}),a.a.createElement(y,null,"Timestamp")),a.a.createElement(C,{records:t,columns:r}),a.a.createElement(k,{table:e,columns:r}))}}]),t}(n.Component)),x=function(e){function t(){return Object(l.a)(this,t),Object(d.a)(this,Object(b.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){var e=this.props,t=e.database,r=e.match,c=r.url.replace(/\/+$/,"");return a.a.createElement(n.Fragment,null,a.a.createElement("strong",null,"Tables"),a.a.createElement("ul",null,t.tables.map(function(e){return a.a.createElement("li",{key:e.name},a.a.createElement(i.b,{to:"".concat(c,"/").concat(e.name)},e.name))})),a.a.createElement("hr",null),t.tables.map(function(e){return a.a.createElement(u.b,{exact:!0,path:"".concat(c,"/").concat(e.name),render:function(){return a.a.createElement(M,{table:e})}})}),a.a.createElement(u.b,{exact:!0,path:r.url,render:function(){return a.a.createElement(u.a,{to:"".concat(c,"/").concat(t.tables[0].name)})}}))}}]),t}(n.Component),F=r(35),T=r(15),q=r(29),J=r.n(q),N=r(2),z=r(36),P=r.n(z),_=function(){return([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,function(e){return((15&(e^crypto.getRandomValues(new Uint8Array(1))[0]))>>e/4).toString(16)})},B=N.d.model({id:N.d.frozen(N.d.string),attributes:N.d.frozen(),timestamp:N.d.maybeNull(N.d.string)}).views(function(e){return{get deleteURL(){return Object(N.b)(e,Q).deleteURL(e)},get writeURL(){return console.log(Object(N.c)(e)),Object(N.b)(e,Q).writeURL(e)},get attributeString(){return console.log(JSON.stringify(e.attributes)),JSON.stringify(e.attributes)}}}).actions(function(e){return{copy:function(){return B.create(Object(N.c)(e))},destroy:function(){return fetch(e.deleteURL,{method:"post"}).then(function(e){return alert("Record deleted")}),Object(N.b)(e,Q).removeRecord(e),!0},persist:function(){return fetch(e.writeURL,{method:"post"}).then(function(e){return alert("Record saved")}),e.timestamp=null,!0},update:function(t){console.log(t),e.attributes=t,e.persist()},setID:function(t){e.id=t},setAttribute:function(t,r){e.attributes=Object.assign({},e.attributes,Object(T.a)({},t,r))}}}),K=B,Q=N.d.model({name:N.d.string,googleID:N.d.string,records:N.d.array(K),columns:N.d.array(N.d.string)}).views(function(e){return{get readURL(){return"".concat(Object(N.b)(e,V).readURL,"#gid=").concat(e.googleID)}}}).actions(function(e){return{addRecord:function(t){e.records.push(t)},createRecord:function(t){return e.records.push(t),e.records[e.records.length-1]},deleteURL:function(t){var r=t.id;return Object(N.b)(e,V).writeURL({table:e.name,id:r,attributes:"delete"})},fetchRecords:function(){e.records=[],e._query("SELECT *").then(e.fetchRecordsSuccess,e.fetchRecordsError)},fetchRecordsSuccess:function(t){e.state="done",e.records=t},fetchRecordsError:function(t){console.error("Failed to fetch records",t),e.state="error"},newRecord:function(){var t={};return e.columns.forEach(function(e){t[e]=""}),K.create({id:_(),attributes:t})},removeRecord:function(e){Object(N.a)(e)},writeURL:function(t){var r=t.id,n=t.attributeString;return Object(N.b)(e,V).writeURL({table:e.name,id:r,attributes:n})},_query:function(t){return new Promise(function(r,n){P()({query:t,reset:!0,url:e.readURL,callback:function(e,t,a){if(e)n(e);else{var c=a.rows;c.shift();var o=c.map(function(e){return K.create({id:e.cellsArray[0],attributes:JSON.parse(e.cellsArray[1]),timestamp:e.cellsArray[2]})});r(o)}}})})}}}),V=N.d.model({sheetID:N.d.string,formID:N.d.string,formFields:N.d.frozen(),tables:N.d.array(Q)}).views(function(e){return{get readURL(){return"https://docs.google.com/spreadsheets/d/".concat(e.sheetID)}}}).actions(function(e){return{createTable:function(t){return e.tables.push(t),e.tables[e.tables.length-1]},writeURL:function(t){var r,n=t.table,a=t.id,c=t.attributes,o=J()("https://docs.google.com",{path:"forms/d/e/".concat(e.formID,"/formResponse"),queryParams:(r={},Object(T.a)(r,e.formFields.table,n),Object(T.a)(r,e.formFields.id,a),Object(T.a)(r,e.formFields.attributes,c),r)});return J()("https://bypasscors.herokuapp.com",{path:"api",queryParams:{url:o}})}}}),W=function(e){var t=V.create(Object(F.a)({sheetID:"1sLhgLZfHKkCcZ3SbVy-LIh_o1rQg3k62enEAND0hD9Q"},e));return t.createTable({name:"plants",googleID:"0",columns:["identifier","alt","name","note"]}),t.createTable({name:"relationships",googleID:"1567813754",columns:["plant1","plant2","likes","note"]}),t},Z=function(e){return a.a.createElement(x,Object.assign({database:W((t=e.match.params.key,{formID:t,formFields:{table:"entry.1190729126",id:"entry.149192443",attributes:"entry.538827119"}})),isAdmin:!0,adminKey:e.match.params.key},e));var t},$={formID:"abc",formFields:{table:"entry.1190729126",id:"entry.149192443",attributes:"entry.538827119"}},H=function(e){return a.a.createElement(x,Object.assign({database:W($)},e))};var G=function(){return a.a.createElement(i.a,{basename:"/"},a.a.createElement("div",{style:{padding:20}},a.a.createElement(u.d,null,a.a.createElement(u.b,{path:"/admin/:key/",render:function(e){return a.a.createElement(Z,e)}}),a.a.createElement(u.b,{render:function(e){return a.a.createElement(H,e)}}))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(a.a.createElement(G,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[39,1,2]]]);
//# sourceMappingURL=main.9a75ee10.chunk.js.map