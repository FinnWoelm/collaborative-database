(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{40:function(e,t,r){e.exports=r(56)},45:function(e,t,r){},46:function(e,t,r){},56:function(e,t,r){"use strict";r.r(t);var n=r(0),a=r.n(n),o=r(22),c=r.n(o),i=(r(45),r(17)),u=r(16),s=(r(46),r(3)),l=r(4),d=r(6),b=r(5),f=r(7),m=r(11),p=r(12),h=r(10);function g(){var e=Object(m.a)(["\n  display: inline-block;\n  padding: 8px;\n  display: table-cell;\n  border: 1px solid #d2d2d2;\n  border-top-width: 0px;\n\n  &:not(:first-of-type) {\n    border-left-width: 0px;\n  }\n"]);return g=function(){return e},e}var v=p.a.div(g());function y(){var e=Object(m.a)(["\n  border: none;\n"]);return y=function(){return e},e}var O=Object(p.a)(v)(y());function j(){var e=Object(m.a)(["\n  display: table-row;\n"]);return j=function(){return e},e}var R=p.a.div(j());function E(){var e=Object(m.a)(["\n  background: black;\n  color: white;\n\n  div {\n    font-weight: bold;\n    border-color: black;\n    border-top-width: 1px;\n\n    &:not(:last-of-type) {\n      border-right-color: white;\n    }\n  }\n"]);return E=function(){return e},e}function D(){var e=Object(m.a)(["\n  display: table;\n"]);return D=function(){return e},e}var k=p.a.div(D()),w=Object(p.a)(R)(E()),L=Object(h.a)(function(e){function t(){var e,r;Object(s.a)(this,t);for(var n=arguments.length,a=new Array(n),o=0;o<n;o++)a[o]=arguments[o];return(r=Object(d.a)(this,(e=Object(b.a)(t)).call.apply(e,[this].concat(a)))).acceptSuggestion=function(e){var t=e.attributes,n=t.id,a=t.table,o=t.changes,c=r.props.database.tables.find(function(e){return e.name===a}),i=c.records.find(function(e){return e.id===n})||c.createRecord({id:n});"delete"===o?i.destroy():i.update(o),e.update({accepted:!0})},r}return Object(f.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){this.props.database.tables.forEach(function(e){return e.fetchRecords()})}},{key:"render",value:function(){var e=this,t=this.props.table,r=t.records,n=t.columns;return a.a.createElement(k,null,a.a.createElement(w,null,a.a.createElement(v,null,"ID"),n.map(function(e){return a.a.createElement(v,{key:e},e)}),a.a.createElement(v,null,"Timestamp")),r.map(function(t){return a.a.createElement(R,{key:t.id},a.a.createElement(v,null,t.id),n.map(function(e){return a.a.createElement(v,{key:e},JSON.stringify(t.attributes[e]))}),a.a.createElement(v,null,t.timestamp),t.attributes.accepted?null:a.a.createElement(O,null,a.a.createElement("button",{onClick:function(){return e.acceptSuggestion(t)}},"Accept Suggestion")))}))}}]),t}(n.Component)),C=r(24),U=function(e){var t=e.onClick;return a.a.createElement(O,null,a.a.createElement("button",{onClick:t},"Cancel"))},S=Object(h.a)(function(e){function t(){var e,r;Object(s.a)(this,t);for(var n=arguments.length,a=new Array(n),o=0;o<n;o++)a[o]=arguments[o];return(r=Object(d.a)(this,(e=Object(b.a)(t)).call.apply(e,[this].concat(a)))).setRecordID=function(e){var t=e.target;r.props.recordDraft.setID(t.value)},r.setRecordAttribute=function(e){var t=e.target,n=t.name,a=t.value,o=r.props.recordDraft;o.setAttribute(n,a),console.log(o.attributes)},r}return Object(f.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this,t=this.props,r=t.recordDraft,n=t.columns,o=t.submitLabel,c=t.onSubmit,i=t.onCancel,u=r.id,s=r.attributes;return a.a.createElement(R,{as:"form",onSubmit:c},a.a.createElement(v,null,a.a.createElement("input",{name:"id",value:u,onChange:this.setRecordID,disabled:!0})),n.map(function(t){return a.a.createElement(v,{key:t},a.a.createElement("input",{name:t,value:void 0===s[t]?"":s[t],onChange:e.setRecordAttribute}))}),a.a.createElement(v,null,"\u2014"),a.a.createElement(O,null,a.a.createElement("button",{type:"submit"},o)),i?a.a.createElement(U,{onClick:i}):null)}}]),t}(n.Component)),I=Object(h.a)(function(e){function t(e){var r;return Object(s.a)(this,t),(r=Object(d.a)(this,Object(b.a)(t).call(this,e))).saveRecord=function(e){e.preventDefault();var t=r.props,n=t.table;(0,t.onCreateRecord)({table:n,recordDraft:r.state.recordDraft})&&r.clearForm()},r.state={recordDraft:e.table.newRecord()},r}return Object(f.a)(t,e),Object(l.a)(t,[{key:"clearForm",value:function(){var e=this.props.table;this.setState({recordDraft:e.newRecord()})}},{key:"render",value:function(){var e=this.props,t=e.columns,r=e.createLabel,n=this.state.recordDraft;return a.a.createElement(S,{recordDraft:n,columns:t,submitLabel:r,onSubmit:this.saveRecord})}}]),t}(n.Component)),T=r(23),A=function(e){function t(e){var r;return Object(s.a)(this,t),(r=Object(d.a)(this,Object(b.a)(t).call(this,e))).resetRecord=function(e){e.preventDefault(),r.props.afterEditRecord()},r.updateRecord=function(e){e.preventDefault();var t=r.state.recordDraft,n=r.props,a=n.record,o=n.onUpdateRecord,c=n.afterUpdateRecord;o({record:a,recordDraft:t})&&c()},r.state={recordDraft:e.record.copy()},r}return Object(f.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this.props,t=e.columns,r=e.updateLabel,n=this.state.recordDraft;return a.a.createElement(S,{recordDraft:n,columns:t,submitLabel:r,onSubmit:this.updateRecord,onCancel:this.resetRecord})}}]),t}(n.Component),x=Object(h.a)(function(e){function t(e){var r;return Object(s.a)(this,t),(r=Object(d.a)(this,Object(b.a)(t).call(this,e))).enterEditMode=function(){r.setState({editMode:!0})},r.exitEditMode=function(){r.setState({editMode:!1})},r.destroyRecord=function(){var e=r.props,t=e.record;(0,e.onDestroyRecord)(Object(T.a)({},{record:t}))},r.state={editMode:!1},r}return Object(f.a)(t,e),Object(l.a)(t,[{key:"editMode",value:function(){return this.state.editMode}},{key:"render",value:function(){var e=this.props,t=e.record,r=e.columns,n=e.onUpdateRecord,o=e.editLabel,c=e.updateLabel,i=e.destroyLabel,u=t.id,s=t.attributes,l=t.timestamp;return this.editMode()?a.a.createElement(A,{record:t,columns:r,updateLabel:c,onUpdateRecord:n,afterUpdateRecord:this.exitEditMode}):a.a.createElement(R,null,a.a.createElement(v,null,u),r.map(function(e){return a.a.createElement(v,{key:e},s[e])}),a.a.createElement(v,null,l),a.a.createElement(O,null,a.a.createElement("button",{onClick:this.enterEditMode},o)),a.a.createElement(O,null,a.a.createElement("button",{onClick:this.destroyRecord},i)))}}]),t}(n.Component)),M=Object(h.a)(function(e){var t=e.records,r=Object(C.a)(e,["records"]);return t.map(function(e){return a.a.createElement(x,Object.assign({key:e.id,record:e},r))})});function F(){var e=Object(m.a)(["\n  background: black;\n  color: white;\n\n  div {\n    font-weight: bold;\n    border-color: black;\n    border-top-width: 1px;\n\n    &:not(:last-of-type) {\n      border-right-color: white;\n    }\n  }\n"]);return F=function(){return e},e}function K(){var e=Object(m.a)(["\n  display: table;\n"]);return K=function(){return e},e}var J=p.a.div(K()),N=Object(p.a)(R)(F()),z=Object(h.a)(function(e){function t(){return Object(s.a)(this,t),Object(d.a)(this,Object(b.a)(t).apply(this,arguments))}return Object(f.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){this.props.table.fetchRecords()}},{key:"render",value:function(){var e=this.props,t=e.table,r=e.onCreateRecord,n=e.onUpdateRecord,o=e.onDestroyRecord,c=e.createLabel,i=e.editLabel,u=e.updateLabel,s=e.destroyLabel,l=t.records,d=t.columns;return a.a.createElement(J,null,a.a.createElement(N,null,a.a.createElement(v,null,"ID"),d.map(function(e){return a.a.createElement(v,{key:e},e)}),a.a.createElement(v,null,"Timestamp")),a.a.createElement(M,{records:l,columns:d,editLabel:i,updateLabel:u,onUpdateRecord:n,onDestroyRecord:o,destroyLabel:s}),a.a.createElement(I,{table:t,columns:d,createLabel:c,onCreateRecord:r}))}}]),t}(n.Component)),q=function(e){function t(){return Object(s.a)(this,t),Object(d.a)(this,Object(b.a)(t).apply(this,arguments))}return Object(f.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this.props,t=e.database,r=e.match,o=Object(C.a)(e,["database","match"]),c=r.url.replace(/\/+$/,""),s=t.tables.filter(function(e){return"suggestions"!==e.name});return a.a.createElement(n.Fragment,null,a.a.createElement("strong",null,"Tables"),a.a.createElement("ul",null,s.map(function(e){return a.a.createElement("li",{key:e.name},a.a.createElement(i.b,{to:"".concat(c,"/").concat(e.name)},e.name))})),a.a.createElement("hr",null),s.map(function(e){return a.a.createElement(u.b,{key:e.name,exact:!0,path:"".concat(c,"/").concat(e.name),render:function(){return a.a.createElement(z,Object.assign({table:e},o))}})}),a.a.createElement(u.b,{exact:!0,path:r.url,render:function(){return a.a.createElement(u.a,{to:"".concat(c,"/").concat(s[0].name)})}}))}}]),t}(n.Component),H=r(15),P=r(36),V=r.n(P),W=r(2),$=r(37),_=r.n($),B=function(){return([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,function(e){return((15&(e^crypto.getRandomValues(new Uint8Array(1))[0]))>>e/4).toString(16)})},Q=W.d.model({id:W.d.frozen(W.d.string),attributes:W.d.frozen(),timestamp:W.d.maybeNull(W.d.string)}).views(function(e){return{get deleteURL(){return e.table.deleteURL(e)},get table(){return Object(W.b)(e,G)},get writeURL(){return console.log(Object(W.c)(e)),e.table.writeURL(e)},get attributeString(){return console.log(JSON.stringify(e.attributes)),JSON.stringify(e.attributes)}}}).actions(function(e){return{copy:function(){return Q.create(Object(W.c)(e))},destroy:function(){return fetch(e.deleteURL,{method:"post"}).then(function(e){return alert("Record deleted")}),e.table.removeRecord(e),!0},persist:function(){return fetch(e.writeURL,{method:"post"}).then(function(e){alert("Saved"),e.text().then(function(e){return console.log(e)})}),e.timestamp=null,!0},update:function(t){console.log(t),e.attributes=Object.assign({},e.attributes,t),e.persist()},setID:function(t){e.id=t},setAttribute:function(t,r){e.attributes=Object.assign({},e.attributes,Object(H.a)({},t,r))}}}),Z=Q,G=W.d.model({name:W.d.string,googleID:W.d.string,records:W.d.array(Z),columns:W.d.array(W.d.string)}).views(function(e){return{get readURL(){return"".concat(Object(W.b)(e,X).readURL,"#gid=").concat(e.googleID)}}}).actions(function(e){return{addRecord:function(t){e.records.push(t)},createRecord:function(t){return e.records.push(t),e.records[e.records.length-1]},deleteURL:function(t){var r=t.id;return Object(W.b)(e,X).writeURL({table:e.name,id:r,attributes:"delete"})},fetchRecords:function(){e.records=[],e._query("SELECT *").then(e.fetchRecordsSuccess,e.fetchRecordsError)},fetchRecordsSuccess:function(t){e.state="done",e.records=t},fetchRecordsError:function(t){console.error("Failed to fetch records",t),e.state="error"},newRecord:function(){var t={};return e.columns.forEach(function(e){t[e]=""}),Z.create({id:B(),attributes:t})},removeRecord:function(e){Object(W.a)(e)},writeURL:function(t){var r=t.id,n=t.attributeString;return Object(W.b)(e,X).writeURL({table:e.name,id:r,attributes:n})},_query:function(t){return new Promise(function(r,n){_()({query:t,reset:!0,url:e.readURL,callback:function(e,t,a){if(e)n(e);else{var o=a.rows;o.shift();var c=o.map(function(e){return Z.create({id:e.cellsArray[0],attributes:JSON.parse(e.cellsArray[1]),timestamp:e.cellsArray[2]})});r(c)}}})})}}}),X=W.d.model({sheetID:W.d.string,formID:W.d.string,formFields:W.d.frozen(),tables:W.d.array(G)}).views(function(e){return{get readURL(){return"https://docs.google.com/spreadsheets/d/".concat(e.sheetID)}}}).actions(function(e){return{createTable:function(t){return e.tables.push(t),e.tables[e.tables.length-1]},writeURL:function(t){var r,n=t.table,a=t.id,o=t.attributes;return V()("https://script.google.com/",{path:"macros/s/AKfycbypjmWHNvoID5K5tyodKMzbagGSA3UzHPArgvtJrcpx-LsmVaw/exec",queryParams:(r={},Object(H.a)(r,e.formFields.table,n),Object(H.a)(r,e.formFields.id,a),Object(H.a)(r,e.formFields.attributes,o),Object(H.a)(r,"adminKey",e.formID),r)})}}}),Y=function(e){var t=X.create(Object(T.a)({sheetID:"1sLhgLZfHKkCcZ3SbVy-LIh_o1rQg3k62enEAND0hD9Q"},e));return t.createTable({name:"plants",googleID:"0",columns:["identifier","alt","name","note"]}),t.createTable({name:"relationships",googleID:"1567813754",columns:["plant1","plant2","likes","note"]}),t.createTable({name:"suggestions",googleID:"2121427503",columns:["table","id","changes","accepted"]}),t},ee=function(e){return{formID:e,formFields:{table:"Table",id:"ID",attributes:"Attributes"}}},te=function(e){function t(e){var r;return Object(s.a)(this,t),(r=Object(d.a)(this,Object(b.a)(t).call(this,e))).onCreateRecord=function(e){var t=e.table,r=e.recordDraft;return t.addRecord(r),r.persist(),!0},r.onUpdateRecord=function(e){var t=e.record,r=e.recordDraft;return t.update(r.attributes),!0},r.onDestroyRecord=function(e){return e.record.destroy(),!0},r.state={database:Y(ee(r.adminKey()))},r}return Object(f.a)(t,e),Object(l.a)(t,[{key:"adminKey",value:function(){return this.props.match.params.key}},{key:"suggestionTable",value:function(){return this.state.database.tables.find(function(e){return"suggestions"===e.name})}},{key:"render",value:function(){var e=this,t=this.props.match.url.replace(/\/+$/,"");return a.a.createElement(n.Fragment,null,a.a.createElement(i.b,{to:"".concat(t,"/suggestions")},"Review suggestions"),a.a.createElement("br",null),a.a.createElement("br",null),a.a.createElement(q,Object.assign({database:this.state.database,isAdmin:!0,adminKey:this.adminKey(),createLabel:"Create",onCreateRecord:this.onCreateRecord,editLabel:"Edit",updateLabel:"Update",onUpdateRecord:this.onUpdateRecord,destroyLabel:"Delete",onDestroyRecord:this.onDestroyRecord},this.props)),a.a.createElement(u.b,{path:"".concat(t,"/suggestions"),render:function(t){return a.a.createElement(L,{database:e.state.database,table:e.suggestionTable()})}}))}}]),t}(n.Component),re={formID:"",formFields:{table:"Table",id:"ID",attributes:"Attributes"}},ne=function(e){function t(e){var r;return Object(s.a)(this,t),(r=Object(d.a)(this,Object(b.a)(t).call(this,e))).onCreateRecord=function(e){var t=e.table,n=e.recordDraft,a=r.suggestionTable().newRecord();return r.suggestionTable().addRecord(a),a.update({table:t.name,id:n.id,changes:n.attributes}),!0},r.onUpdateRecord=function(e){var t=e.record,n=e.recordDraft,a=r.suggestionTable().newRecord();return r.suggestionTable().addRecord(a),a.update({table:t.table.name,id:t.id,changes:n.attributes}),!0},r.onDestroyRecord=function(e){var t=e.record,n=r.suggestionTable().newRecord();return r.suggestionTable().addRecord(n),n.update({table:t.table.name,id:t.id,changes:"delete"}),!0},r.state={database:Y(re)},r}return Object(f.a)(t,e),Object(l.a)(t,[{key:"suggestionTable",value:function(){return this.state.database.tables.find(function(e){return"suggestions"===e.name})}},{key:"render",value:function(){return a.a.createElement(q,Object.assign({database:this.state.database,createLabel:"Suggest Creation",onCreateRecord:this.onCreateRecord,editLabel:"Suggest Edit",updateLabel:"Suggest Update",onUpdateRecord:this.onUpdateRecord,destroyLabel:"Suggest Deletion",onDestroyRecord:this.onDestroyRecord},this.props))}}]),t}(n.Component);var ae=function(){return a.a.createElement(i.a,{basename:"/"},a.a.createElement("div",{style:{padding:20}},a.a.createElement(u.d,null,a.a.createElement(u.b,{path:"/admin/:key/",render:function(e){return a.a.createElement(te,e)}}),a.a.createElement(u.b,{render:function(e){return a.a.createElement(ne,e)}}))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));c.a.render(a.a.createElement(ae,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[40,1,2]]]);
//# sourceMappingURL=main.f397027c.chunk.js.map